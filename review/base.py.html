<html><head><title>base.py</title><link rel="stylesheet" type="text/css" href="/style.css"></head><body><article>
    <div id="container"><div class="comment ui-draggable ui-draggable-handle" style="top: 278px; left: 18px;" data-lines="[16]">incorrect http status code</div><div class="comment ui-draggable ui-draggable-handle" style="top: 1052px; left: 18px;" data-lines="[59]">incorrect http status code</div><div class="comment ui-draggable ui-draggable-handle" style="top: 656px; left: 18px;" data-lines="[37,38,39,40]">sql</div></div>
    <table id="source"><tbody><tr><td>1</td><td><pre>from api.utils import api_response, photo_id_to_url</pre></td></tr><tr><td>2</td><td><pre></pre></td></tr><tr><td>3</td><td><pre>from mypinnings.database import connect_db</pre></td></tr><tr><td>4</td><td><pre></pre></td></tr><tr><td>5</td><td><pre>db = connect_db()</pre></td></tr><tr><td>6</td><td><pre></pre></td></tr><tr><td>7</td><td><pre></pre></td></tr><tr><td>8</td><td><pre>class BaseAPI(object):</pre></td></tr><tr><td>9</td><td><pre>    """</pre></td></tr><tr><td>10</td><td><pre>    Base class for API handler</pre></td></tr><tr><td>11</td><td><pre>    """</pre></td></tr><tr><td>12</td><td><pre>    def GET(self):</pre></td></tr><tr><td>13</td><td><pre>        """</pre></td></tr><tr><td>14</td><td><pre>        Wrong HTTP method for API handling</pre></td></tr><tr><td>15</td><td><pre>        """</pre></td></tr><tr class="accepted"><td>16</td><td><pre>        status = 405</pre></td></tr><tr><td>17</td><td><pre>        error_code = "Method Not Allowed"</pre></td></tr><tr><td>18</td><td><pre>        data = {}</pre></td></tr><tr><td>19</td><td><pre>        response = api_response(data, status=status, error_code=error_code)</pre></td></tr><tr><td>20</td><td><pre>        return response</pre></td></tr><tr><td>21</td><td><pre></pre></td></tr><tr><td>22</td><td><pre>    def POST(self):</pre></td></tr><tr><td>23</td><td><pre>        """</pre></td></tr><tr><td>24</td><td><pre>        Handler for API call. Must be overriden</pre></td></tr><tr><td>25</td><td><pre>        """</pre></td></tr><tr><td>26</td><td><pre>        raise NotImplemented</pre></td></tr><tr><td>27</td><td><pre></pre></td></tr><tr><td>28</td><td><pre>    def authenticate_by_token(self, logintoken):</pre></td></tr><tr><td>29</td><td><pre>        """Authenticates user by given logintoken</pre></td></tr><tr><td>30</td><td><pre></pre></td></tr><tr><td>31</td><td><pre>        Returns:</pre></td></tr><tr><td>32</td><td><pre>        status - flag set to True in case if user was successfully logged in</pre></td></tr><tr><td>33</td><td><pre>        user_dict - dictionary with users  profile data (if login success)</pre></td></tr><tr><td>34</td><td><pre>        access_denied - if login failure</pre></td></tr><tr><td>35</td><td><pre>        """</pre></td></tr><tr><td>36</td><td><pre>        success = False</pre></td></tr><tr class="accepted"><td>37</td><td><pre>        user = db.select(</pre></td></tr><tr class="accepted"><td>38</td><td><pre>            'users',</pre></td></tr><tr class="accepted"><td>39</td><td><pre>            {"logintoken": logintoken},</pre></td></tr><tr class="accepted"><td>40</td><td><pre>            where="logintoken=$logintoken"</pre></td></tr><tr><td>41</td><td><pre>        )</pre></td></tr><tr><td>42</td><td><pre>        if len(user) &gt; 0:</pre></td></tr><tr><td>43</td><td><pre>            success = True</pre></td></tr><tr><td>44</td><td><pre>            user = user.list()[0]</pre></td></tr><tr><td>45</td><td><pre>            # user['pic'] = photo_id_to_url(user['pic'])</pre></td></tr><tr><td>46</td><td><pre>            return success, user</pre></td></tr><tr><td>47</td><td><pre>        else:</pre></td></tr><tr><td>48</td><td><pre>            if logintoken is None:</pre></td></tr><tr><td>49</td><td><pre>                error_code = "Not received login token"</pre></td></tr><tr><td>50</td><td><pre>            else:</pre></td></tr><tr><td>51</td><td><pre>                error_code = "Wrong login token"</pre></td></tr><tr><td>52</td><td><pre>            return success, self.access_denied(error_code)</pre></td></tr><tr><td>53</td><td><pre></pre></td></tr><tr><td>54</td><td><pre>    def access_denied(self, error_code="Default error: access_denied"):</pre></td></tr><tr><td>55</td><td><pre>        """</pre></td></tr><tr><td>56</td><td><pre>        Access denied errors</pre></td></tr><tr><td>57</td><td><pre>        """</pre></td></tr><tr><td>58</td><td><pre>        data = {}</pre></td></tr><tr class="accepted"><td>59</td><td><pre>        status = 405</pre></td></tr><tr><td>60</td><td><pre>        return api_response(data=data, status=status, error_code=error_code)</pre></td></tr><tr><td>61</td><td><pre></pre></td></tr></tbody></table>
</article></body></html>