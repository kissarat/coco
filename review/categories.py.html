<html><head><title>categories.py</title><link rel="stylesheet" type="text/css" href="/style.css"></head><body><article>
    <div id="container"><div class="comment ui-draggable ui-draggable-handle" style="top: 620px; left: 18px;" data-lines="[35,36,37,38]">sql</div></div>
    <table id="source"><tbody><tr><td>1</td><td><pre>import os</pre></td></tr><tr><td>2</td><td><pre>import web</pre></td></tr><tr><td>3</td><td><pre>import uuid</pre></td></tr><tr><td>4</td><td><pre>import datetime</pre></td></tr><tr><td>5</td><td><pre>import math</pre></td></tr><tr><td>6</td><td><pre>import random</pre></td></tr><tr><td>7</td><td><pre></pre></td></tr><tr><td>8</td><td><pre>from mypinnings import database</pre></td></tr><tr><td>9</td><td><pre>from api.views.base import BaseAPI</pre></td></tr><tr><td>10</td><td><pre>from api.utils import api_response, save_api_request</pre></td></tr><tr><td>11</td><td><pre>from mypinnings.database import connect_db</pre></td></tr><tr><td>12</td><td><pre>from mypinnings.conf import settings</pre></td></tr><tr><td>13</td><td><pre></pre></td></tr><tr><td>14</td><td><pre>db = connect_db()</pre></td></tr><tr><td>15</td><td><pre></pre></td></tr><tr><td>16</td><td><pre></pre></td></tr><tr><td>17</td><td><pre>class GetCategories(BaseAPI):</pre></td></tr><tr><td>18</td><td><pre>    """</pre></td></tr><tr><td>19</td><td><pre>    API for receiving list of categories</pre></td></tr><tr><td>20</td><td><pre>    """</pre></td></tr><tr><td>21</td><td><pre>    def POST(self):</pre></td></tr><tr><td>22</td><td><pre>        request_data = web.input(</pre></td></tr><tr><td>23</td><td><pre>        )</pre></td></tr><tr><td>24</td><td><pre></pre></td></tr><tr><td>25</td><td><pre>        data = {}</pre></td></tr><tr><td>26</td><td><pre>        status = 200</pre></td></tr><tr><td>27</td><td><pre>        csid_from_server = None</pre></td></tr><tr><td>28</td><td><pre>        error_code = ""</pre></td></tr><tr><td>29</td><td><pre></pre></td></tr><tr><td>30</td><td><pre>        # Get data from request</pre></td></tr><tr><td>31</td><td><pre>        csid_from_client = request_data.get('csid_from_client')</pre></td></tr><tr><td>32</td><td><pre>        csid_from_server = ""</pre></td></tr><tr><td>33</td><td><pre></pre></td></tr><tr><td>34</td><td><pre>        data['categories_list'] = list(</pre></td></tr><tr class="accepted"><td>35</td><td><pre>        	db.select(</pre></td></tr><tr class="accepted"><td>36</td><td><pre>	        	'categories', </pre></td></tr><tr class="accepted"><td>37</td><td><pre>	        	order='position desc, name',</pre></td></tr><tr class="accepted"><td>38</td><td><pre>	            where='parent is null'</pre></td></tr><tr class=""><td>39</td><td><pre>	        )</pre></td></tr><tr><td>40</td><td><pre>	    )</pre></td></tr><tr><td>41</td><td><pre></pre></td></tr><tr><td>42</td><td><pre>        response = api_response(data=data,</pre></td></tr><tr><td>43</td><td><pre>                                status=status,</pre></td></tr><tr><td>44</td><td><pre>                                error_code=error_code,</pre></td></tr><tr><td>45</td><td><pre>                                csid_from_client=csid_from_client,</pre></td></tr><tr><td>46</td><td><pre>                                csid_from_server=csid_from_server)</pre></td></tr><tr><td>47</td><td><pre>        return response</pre></td></tr></tbody></table>
</article></body></html>